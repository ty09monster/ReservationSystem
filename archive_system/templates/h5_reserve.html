<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>填写预约信息</title>
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/h5.css') }}" rel="stylesheet">
</head>
<body>
    <!-- 加载动画 -->
    <div class="loading" id="loading"></div>

    <!-- 顶部导航栏 -->
    <nav class="top-nav">
        <div class="back-btn" onclick="window.history.back()">
            <i class="icon icon-back"></i>
        </div>
        <h1>新建预约</h1>
        <div class="nav-right"></div>
    </nav>

    <!-- 主内容区域 -->
    <div class="main-content">
        <div class="container mt-4">
            <!-- 显示错误信息 -->
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ 'danger' if '错误' in message else 'success' }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            
            <form method="POST">
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">预约人</label>
                            <input type="text" class="form-control" value="{{ user.name }} - {{ user.phone }}" disabled>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">参观校区</label>
                            <select name="area" class="form-select">
                                {% for c in campuses %}
                                <option value="{{ c }}">{{ c }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">参观日期</label>
                            <input type="date" name="visit_date" class="form-control" 
                                   min="{{ moment().format('YYYY-MM-DD') if moment else '' }}" 
                                   required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">时间段</label>
                            <select name="visit_time" class="form-select">
                                {% for t in times %}
                                <option value="{{ t }}">{{ t }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">预约类型</label>
                            <select name="res_type" class="form-select">
                                <option value="个人">个人参观</option>
                                <option value="团队">团队参观</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">访客身份</label>
                            <select name="identity" class="form-select">
                                <option value="校内师生">校内师生</option>
                                <option value="校友">校友</option>
                                <option value="校外人员">校外人员</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">预约缘由</label>
                            <textarea name="reason" class="form-control" rows="3" placeholder="请简要说明参观目的" required></textarea>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary w-100">提交申请</button>
                <a href="{{ url_for('h5.home') }}" class="btn btn-secondary w-100 mt-2">返回</a>
            </form>
        </div>
    </div>

    <!-- 底部导航 -->
    <nav class="bottom-nav">
        <a href="{{ url_for('h5.index') }}" class="bottom-nav-item">
            <i class="icon icon-home"></i>
            <span>首页</span>
        </a>
        <a href="{{ url_for('h5.reserve') }}" class="bottom-nav-item active">
            <i class="icon icon-calendar"></i>
            <span>预约</span>
        </a>
        <a href="{{ url_for('h5.history') }}" class="bottom-nav-item">
            <i class="icon icon-history"></i>
            <span>历史</span>
        </a>
        <a href="{{ url_for('h5.profile') }}" class="bottom-nav-item">
            <i class="icon icon-user"></i>
            <span>我的</span>
        </a>
    </nav>

    <!-- 页脚 -->
    <footer class="footer">
        <p>&copy; <span id="currentYear"></span> 河南农业大学校史馆预约系统 版权所有</p>
    </footer>
    
    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    
    <script>
        // 页面加载完成后隐藏加载动画
        window.onload = function() {
            setTimeout(function() {
                document.getElementById('loading').style.display = 'none';
            }, 1000);
            
            // 设置当前年份
            document.getElementById('currentYear').textContent = new Date().getFullYear();
        };

        // 添加前端JavaScript日期校验
        document.addEventListener('DOMContentLoaded', function() {
            const dateInput = document.querySelector('input[name="visit_date"]');
            const today = new Date();
            const todayStr = today.getFullYear() + '-' + 
                            String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                            String(today.getDate()).padStart(2, '0');
            
            // 设置最小日期为今天
            dateInput.min = todayStr;
            
            // 添加日期校验事件
            dateInput.addEventListener('change', function() {
                const selectedDate = new Date(this.value);
                const currentDate = new Date();
                
                // 设置日期为当天零时以进行准确比较
                currentDate.setHours(0, 0, 0, 0);
                selectedDate.setHours(0, 0, 0, 0);
                
                if (selectedDate < currentDate) {
                    alert('访问日期不能早于今天');
                    this.value = '';
                }
            });
        });
    </script>
</body>
</html>